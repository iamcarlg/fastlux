<%- include("../partials/head.ejs") %>

<%- include("../partials/header-admin") %>

<div class="container emp-profile container-order">
      <div class="row">

        <div class="col-md-4">
          <div class="profile-img">
              <img src="<%= order.user.thumbnail%>" width = "500" height = "500" alt=""/>
          </div>
          <br>
      </div>
      
        </div>
                <div class="row hide-form">
                    <div class="col-md-8">
                        <div class="tab-content profile-tab" id="myTabContent">
                            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Order Id</label>
                                            </div>
                                            <div class="col-md-6">
                                                <p><%= order._id%></p>
                                            </div>
                                        </div>

                                        <div class="row">
                                          <div class="col-md-6">
                                              <label>Email</label>
                                          </div>
                                          <div class="col-md-6">
                                              <p><%= order.email%></p>
                                          </div>
                                      </div>

                                      <div class="row">
                                        <div class="col-md-6">
                                            <label>Quantity ordered</label>
                                        </div>
                                        <div class="col-md-6">
                                            <p><%= order.cart.totalQty %></p>
                                        </div>
                                    </div>

                                    <div class="row">
                                      <div class="col-md-6">
                                          <label>Amount spent</label>
                                      </div>
                                      <div class="col-md-6">
                                          <p><%= order.cart.totalPrice %> â‚¬</p>
                                      </div>
                                  </div>

                                  <div class="row">
                                    <div class="col-md-6">
                                        <label>Order Status</label>
                                    </div>
                                    <div class="col-md-6">
                                        <p><%= order.status %></p>
                                    </div>
                                </div>

                                <div class="row">
                                  <div class="col-md-6">
                                      <label>Order Date</label>
                                  </div>
                                  <div class="col-md-6">
                                      <p><%= order.date %></p>
                                  </div>
                              </div>

                                  <div class="row">
                                    <div class="col-md-6">
                                        <label>User</label>
                                    </div>
                                    <div class="col-md-6">
                                        <p><%= order.user.username %></p>
                                    </div>
                                </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Address</label>
                                            </div>
                                            <div class="col-md-6">
                                                <p><%= order.address %><br><%= order.zipCode %></p>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>ZipCode</label>
                                            </div>
                                            <div class="col-md-6">
                                                <p><%= order.zipcode %></p>
                                            </div>
                                        </div>
                                        <div class="row">
                                          <div class="col-md-6">
                                              <label>City</label>
                                          </div>
                                          <div class="col-md-6">
                                              <p><%= order.city %></p>
                                          </div>
                                      </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Country</label>
                                            </div>
                                            <div class="col-md-6">
                                                <p><%= order.country %></p>
                                            </div>
                                        </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6" style="padding: 20px;">
                      <button class = "update_btn" onclick="update_data();">Edit Order</button>
                      <a class = "delete"><button data-doc = "<%= order._id %>" onclick="deleteOrder();">Delete Order</button></a>
                      
                    </div>


                </div>

            
            <div class = "update_info"style="display : none;">

              <form action = "/admin/updateOrderInfo/<%=order._id %>?_method=PATCH" method = "POST" enctype="multipart/form-data" style = "padding-bottom : 20px;">
                <h1>Update the order info</h1>
                
                <div class="mb-3 mt-3">
                    <input type="email" class="form-control" id="email" name = "email" placeholder="Email" value="<%= order.email %>" required>
                    </div>
                <br>
                <div class="mb-3">
                    <input type="text" class="form-control" id="address" name = "address" placeholder="Address" value="<%= order.address %>" required>
                </div>
                <div class="mb-3">
                  <input type="number" class="form-control" id="zipcode" name = "zipcode" placeholder="Zip-code" value="<%= order.zipcode %>" required>
              </div>
                <div class="mb-3">
                    <input type="text" class="form-control" id="city" name = "city" placeholder="City" value="<%= order.city %>" required>
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control" id="country" name = "country" placeholder="Country" value="<%= order.country %>" required>
                </div>
              <br>
              <!-- <button type="submit" class="btn btn-primary">Update info</button>
               -->

               <center>

                 <div class="col-md-6">
                     <button type = "submit">Update info</button>
                 </div>
                 
               </center>
            </form>
    
            </div>

          </div>

<style>
.emp-profile{
padding: 3%;
margin-top: 3%;
margin-bottom: 3%;
border-radius: 0.5rem;
background: #fff;
}
.profile-img{
text-align: center;
}
.profile-img img{
width: 370px;
height: 370px;
}

.profile-head h5{
color: #333;
}
.profile-head h6{
color: #0062cc;
}
.profile-edit-btn{
border: none;
width: 100%;
padding: 2%;
font-weight: 600;
color: #6c757d;
cursor: pointer;
}
.profile-head .nav-tabs{
margin-bottom:5%;
}
.profile-head .nav-tabs .nav-link{
font-weight:600;
border: none;
}
.profile-head .nav-tabs .nav-link.active{
border: none;
border-bottom:2px solid #0062cc;
}
.profile-work{
padding: 14%;
margin-top: -15%;
}
.profile-work p{
font-size: 12px;
color: #818182;
font-weight: 600;
margin-top: 10%;
}
.profile-work a{
text-decoration: none;
color: #495057;
font-weight: 600;
font-size: 14px;
}
.profile-work ul{
list-style: none;
}
.profile-tab label{
font-weight: 600;
}
.profile-tab p{
font-weight: 600;
color: #0062cc;
}
</style>
        
<style>

  body{
    font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"
  }
  .container{
    margin:10px auto;
    width : 100%; 
    height : 5vh;
    background:#fff; 
    z-index:1;
    display: flex;
    justify-content: space-between;
  }

  .navbar-logo{
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
      font-size:2rem;
      font-weight: bolder;
      text-decoration: none;

    }

    .navbar-logo a{
      color:black;
      text-decoration: none;

    }

  div .navbar-logo{
    padding-top:10px; 
    padding-left:10px;
    color:black;

  }

  .admin-space-navbar{
    text-align: center;
    width : 85%;
    height : 7vh;
    background-color: #2471A3;
    margin: 10px auto;
  }

  nav ul{
    margin: 10px auto;
    
  }
  nav ul li{
    
    display: inline-block;
    list-style: none;
    text-decoration: none;

    margin-top : 10px;
    margin-left:60px;

  }

  nav ul li a{
      color: #fff;
      margin-top : 10px;
      margin-bottom : 10px;
    }

    
    nav ul li a:hover{
      color: #fff;
      text-decoration: none;
    }

    nav ul li a:visited{
      color: #fff;
      text-decoration: none;
    }

  .admin-space{
        width: 100%;
        height : 92vh;

        background-color:rgba(226, 220, 220, 0.9);

        padding-top : 20px;
  }

  .addProduct{
        width : 50%;
        margin: 15px auto;          

    }

    .addProduct textarea{
        height : 100px;
    }

    @media screen and (max-width : 800px) {
    .container-order{
        display: flex; 
        flex-direction: column;
    }

    .review-overview{
      margin-top : 10vh;
  }

    .cart-btn{
      padding : 5px;
      float: left;
      width : 200px;
      margin-top: 10px;
      margin-left :auto;
  }

    .variant{
      height : 10vh;
    }
  }
</style>

<script>

  const update_btn = document.querySelector('.update_btn');
  const update_info = document.querySelector('.update_info');
  const hide_form =  document.querySelector('.hide-form');
  const update_data = () =>{

    if(update_info.style.display = 'none')
      update_info.style.display = 'inline';
      update_btn.style.display = 'none';
      hide_form.style.display = 'none';
  }

  // Handling the delete Operation
  function deleteOrder(){

    let text = "Do you want to delete this order ?";

    if(confirm(text) == true){

      const trashcan = document.querySelector('a.delete');
        trashcan.addEventListener('click', (e) => {
          
          const endpoint = `/admin/order/delete/${event.target.dataset.doc}`;
          fetch(endpoint, {
            method: 'DELETE',
          })
          .then(response => response.json())
          .then(data => window.location.href = data.redirect)
          .catch(err => console.log(err));
        });

    }
  }

</script>

      </body>